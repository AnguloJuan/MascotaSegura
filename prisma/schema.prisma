// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model estado {
  id        Int         @id @default(autoincrement())
  nombre    String
  municipio municipio[]
}

model municipio {
  id       Int    @id @default(autoincrement())
  nombre   String
  idEstado Int

  estado    estado      @relation(fields: [idEstado], references: [id])
  adoptante adoptante[]
  refugio   refugio[]
  reporte   reporte[]
}

model refugio {
  id          Int      @id @default(autoincrement())
  nombre      String?
  espacios    Int?
  fechaCreada DateTime @default(now())
  idMunicipio Int

  municipio municipio  @relation(fields: [idMunicipio], references: [id])
  adopcion  adopcion[]
  espacio   espacios[]
  mascotas mascota[]
}

model adoptante {
  id                   Int      @id @default(autoincrement())
  nombre               String
  apellido             String
  correo               String   @unique
  telefono             BigInt
  contrasena           String
  fechaRegistro        DateTime @default(now())
  idMunicipio          Int
  idHistorialAdoptante Int?
  idTipoUsuario        Int

  municipio         municipio          @relation(fields: [idMunicipio], references: [id])
  historialAdoptivo historialAdoptivo? @relation("historialAdoptante", fields: [idHistorialAdoptante], references: [id])
  tipoUsuario       tipoUsuario        @relation(fields: [idTipoUsuario], references: [id])
  adopcion          adopcion[]
  reportador        reporte[]          @relation("reportador")
  reportado         reporte[]          @relation("reportado")
}

model empleado {
  id            Int      @id @default(autoincrement())
  idRefugio     Int
  nombre        String
  apellido      String
  correo        String   @unique
  contrasena    String
  telefono      BigInt
  NIP           String
  fechaRegistro DateTime @default(now())
  idTipoUsuario Int

  tipoUsuario tipoUsuario @relation(fields: [idTipoUsuario], references: [id])
}

model tipoUsuario {
  id      Int    @id
  usuario String

  empleado  empleado[]
  adoptante adoptante[]
}

model historialAdoptivo {
  id          Int @id @default(autoincrement())
  idMascota   Int @unique
  idAdoptante Int

  mascota    mascota     @relation("historialMascota", fields: [idMascota], references: [id])
  adoptantes adoptante[] @relation("historialAdoptante")
  motivo     String?     @default("Sin motivo espec√≠fico")
}

model cartilla {
  id        Int   @id @default(autoincrement())
  cartilla  Bytes
  idMascota Int   @unique

  mascota mascota @relation(fields: [idMascota], references: [id])
}

model sexo {
  id   Int    @id
  sexo String

  mascota mascota[]
}

model mascota {
  id            Int      @id @default(autoincrement())
  nombre        String?
  edad          Int?
  meses         Int?
  raza          String?  @default("Desconocida")
  maltratado    Boolean
  fechaRegistro DateTime @default(now())
  perfil        String?
  idRefugio     Int?
  idHistorial   Int
  idCartilla    Int
  idSexo        Int
  idTamano      Int?     @default(1)
  idEspecie     Int

  refugio refugio? @relation(fields: [idRefugio], references: [id])
  historialAdoptivo historialAdoptivo? @relation("historialMascota")
  cartilla          cartilla?
  sexo              sexo               @relation(fields: [idSexo], references: [id])
  tamano            tamano?            @relation(fields: [idTamano], references: [id])
  especie           especie            @relation(fields: [idEspecie], references: [id])
  adopcion          adopcion?
  victima           reporte[]
}

model adopcion {
  id               Int      @id @default(autoincrement())
  fechaCreada      DateTime @default(now())
  idAdoptante      Int
  idMascota        Int      @unique
  idRefugio        Int
  idEstadoAdopcion Int

  adoptante      adoptante      @relation(fields: [idAdoptante], references: [id])
  mascota        mascota        @relation(fields: [idMascota], references: [id])
  refugio        refugio        @relation(fields: [idRefugio], references: [id])
  estadoAdopcion estadoAdopcion @relation(fields: [idEstadoAdopcion], references: [id])
}

model reporte {
  id           Int      @id @default(autoincrement())
  descripcion  String
  fechaCreada  DateTime @default(now())
  idReportador Int?
  idReportado  Int?
  idMascota    Int?
  idMunicipio  Int

  reportador adoptante? @relation("reportador", fields: [idReportador], references: [id])
  reportado  adoptante? @relation("reportado", fields: [idReportado], references: [id])
  mascota    mascota?   @relation(fields: [idMascota], references: [id])
  municipio  municipio  @relation(fields: [idMunicipio], references: [id])
}

model especie {
  id       Int        @id
  especie  String
  mascota  mascota[]
  espacios espacios[]
}

model espacios {
  id                Int @id
  espacioTotal      Int
  espacioDisponible Int
  idEspecie         Int
  idRefugio         Int

  especie especie @relation(fields: [idEspecie], references: [id])
  refugio refugio @relation(fields: [idRefugio], references: [id])
}

model estadoAdopcion {
  id             Int        @id
  estadoAdopcion String
  adopcion       adopcion[]
}

model tamano {
  id      Int       @id
  tamano  String
  mascota mascota[]
}
